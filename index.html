<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffcd00">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ADAC OEM">
    <meta name="mobile-web-app-capable" content="yes">
    <title>ADAC - OEM Datenplattform Zustimmung</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.5/tesseract.min.js"></script>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQURBQyBPRU0gRGF0ZW5wbGF0dGZvcm0iLCJzaG9ydF9uYW1lIjoiQURBQyBPRU0iLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmOGY5ZmEiLCJ0aGVtZV9jb2xvciI6IiNmZmNkMDAiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFOUUFBQURVQ0FZQUFBQUJ0WG55QUFBQUFYR1NSTkFBQWRFaUFBd1ZCR0RBa0FBQUNOVXFHUz0iLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn0seyJzcmMiOiJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQTFBQUFBRUFDQVLBQUFCRVR5R0FBQUJSbERRVlI0blBQZHhqQUFCUWpOU2w4QUFBQzVVbEVRVlJnZTJyZ3lzRHg5Nks3cGMrYXVXN1k0TnRvTnQwb0c5aXhPaUQrVG9Kb2lNSEF0SmhyQURJdEFnYURhQUlDU0VLa0pNQ3FYeVhKRUN5WXB4V1owZERGZlJ6Tmc3ZlVyQT0iLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dfQ==">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAYAAAA9zQYyAAAAAXNSR0IArs4c6QAABYhJREFUeF7t3U9oW3Ucx/H3l6RJm7RN27Rp2rRJ07RJ27Rp2rRJ27Rp2rRJ27Rp2rRJ0yZt0yZN2rRp2rRJ27Rp0yZt0yZN26ZN26ZN26ZN26ZN0yZt0yZN26ZN26ZN0yZNm7RJ0yZt0yZNmzRt0rRJ0yZt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rZJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0rRJ0yZNmzRt0A==">
    <link rel="apple-touch-icon" sizes="152x152" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJgAAACYCAYAAAAYwiAhAAAAAXNSR0IArs4c6QAABThJREFUeF7t3U9oW3Ucx/H3l6RJm7RN27Rp2rRJ0yZt0rRJ0yZt0yZt0rRJ0yZt0yZt0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0A==">
    <link rel="apple-touch-icon" sizes="120x120" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAABEhJREFUeF7t3U9oW3Ucx/H3l6RJm7RN27Rp2rRJ0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0yZt0yZt0rRJ0yZt0A==">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #000;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #ffcd00;
            color: #000;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 205, 0, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.8;
        }

        .content {
            background: white;
            flex: 1;
            padding: 30px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            background: #ffcd00;
            color: #000;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-weight: bold;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #000;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ffcd00;
            box-shadow: 0 0 0 3px rgba(255, 205, 0, 0.2);
        }

        .btn {
            background: #ffcd00;
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
        }

        .btn:hover {
            background: #e6b800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 205, 0, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .verification-list {
            list-style: none;
            padding: 0;
        }

        .verification-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e9ecef;
            transition: all 0.5s;
        }

        .verification-item.checking {
            border-left-color: #ffcd00;
            background: #fff9e6;
        }

        .verification-item.success {
            border-left-color: #28a745;
            background: #f0fff0;
        }

        .verification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .verification-icon.pending {
            background: #e9ecef;
            color: #6c757d;
        }

        .verification-icon.checking {
            background: #ffcd00;
            color: #000;
            animation: pulse 1.5s infinite;
        }

        .verification-icon.success {
            background: #28a745;
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .verification-text {
            font-weight: 500;
        }

        .vin-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffcd00;
        }

        .vin-display strong {
            color: #ffcd00;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
            margin-top: 4px;
            transform: scale(1.2);
        }

        .checkbox-group label {
            flex: 1;
            margin-bottom: 0;
            font-weight: normal;
            line-height: 1.5;
        }

        .consent-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffcd00;
            font-size: 14px;
            line-height: 1.6;
        }

        .success-message {
            text-align: center;
            padding: 30px;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 40px;
        }

        .progress-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #ffcd00;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #ffcd00;
            color: #000;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            font-size: 14px;
        }

        .install-prompt button {
            background: #000;
            color: #ffcd00;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 12px;
        }

        .install-prompt .close-btn {
            background: transparent;
            color: #000;
            font-size: 20px;
            padding: 0;
            width: 30px;
            height: 30px;
            margin-left: auto;
        }

        .safari-instructions {
            font-size: 12px;
            line-height: 1.4;
            margin-top: 8px;
        }

        .safari-instructions strong {
            color: #000;
        }

        /* Mobile Optimierungen */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .step-header {
                font-size: 16px;
                padding: 12px 15px;
            }
            
            .form-group input {
                font-size: 16px; /* Verhindert Zoom auf iOS */
            }

            .scanner-frame {
                width: 250px;
                height: 70px;
            }

            .scanner-instructions p {
                font-size: 14px;
            }

            .scanner-close-btn {
                top: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
                font-size: 20px;
            }

            .scanner-debug {
                bottom: 15px;
                left: 15px;
                right: 15px;
                font-size: 13px;
                max-height: 180px;
                padding: 12px;
            }

            .scanner-debug h4 {
                font-size: 14px;
                margin-bottom: 8px;
            }

            .scanner-debug .debug-line {
                margin-bottom: 6px;
                padding: 4px;
                font-size: 12px;
            }

            .debug-toggle {
                bottom: 210px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .info-item {
                padding: 10px;
            }

            .info-label {
                font-size: 11px;
            }

            .info-value {
                font-size: 14px;
            }

            .tech-details {
                gap: 8px;
                font-size: 11px;
            }

            .tech-details span {
                padding: 4px 8px;
            }

            .decoder-status {
                padding: 8px;
                margin-bottom: 15px;
            }

            .decoder-status .status-text {
                font-size: 11px;
            }
        }

        /* PWA Standalone Mode */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        /* VIN Scanner Styles */
        .scanner-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
        }

        #cameraVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
        }

        .scanner-frame {
            position: relative;
            width: 280px;
            height: 80px;
            border: 2px solid #ffcd00;
            border-radius: 8px;
            background: rgba(255, 205, 0, 0.1);
            margin-bottom: 40px;
        }

        .scanner-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ffcd00, transparent);
            animation: scanLine 2s ease-in-out infinite;
            transform: translateY(-50%);
        }

        @keyframes scanLine {
            0%, 100% { transform: translateY(-50%) scaleX(0.8); opacity: 0.5; }
            50% { transform: translateY(-50%) scaleX(1.2); opacity: 1; }
        }

        .scanner-corners {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid #ffcd00;
        }

        .corner.top-left {
            top: -3px;
            left: -3px;
            border-right: none;
            border-bottom: none;
        }

        .corner.top-right {
            top: -3px;
            right: -3px;
            border-left: none;
            border-bottom: none;
        }

        .corner.bottom-left {
            bottom: -3px;
            left: -3px;
            border-right: none;
            border-top: none;
        }

        .corner.bottom-right {
            bottom: -3px;
            right: -3px;
            border-left: none;
            border-top: none;
        }

        .scanner-instructions {
            text-align: center;
            color: white;
        }

        .scanner-instructions p {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .scanner-status {
            font-size: 14px;
            color: #ffcd00;
            font-weight: bold;
        }

        .scanner-debug {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            padding: 15px;
            border-radius: 12px;
            font-size: 14px;
            font-family: Arial, sans-serif;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #ffcd00;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .scanner-debug h4 {
            color: #000;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 2px solid #ffcd00;
            padding-bottom: 5px;
        }

        .scanner-debug .debug-line {
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 6px;
            font-weight: 500;
        }

        .scanner-debug .info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .scanner-debug .success {
            background: #e8f5e8;
            color: #2e7d32;
            font-weight: bold;
        }

        .scanner-debug .warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .scanner-debug .error {
            background: #ffebee;
            color: #d32f2f;
            font-weight: bold;
        }

        .scanner-debug .ocr-text {
            background: #f3e5f5;
            color: #7b1fa2;
            font-family: monospace;
            font-size: 12px;
        }

        .debug-toggle {
            position: absolute;
            bottom: 240px;
            right: 20px;
            background: #ffcd00;
            color: #000;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .scanner-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scan-option {
            text-align: center;
            margin-bottom: 20px;
        }

        .scan-btn {
            background: #28a745;
            margin-bottom: 15px;
        }

        .scan-btn:hover {
            background: #218838;
        }

        .or-divider {
            color: #666;
            font-size: 14px;
            position: relative;
            margin: 15px 0;
        }

        .or-divider::before,
        .or-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background: #e9ecef;
        }

        .or-divider::before {
            left: 0;
        }

        .or-divider::after {
            right: 0;
        }

        .scanner-success {
            animation: scanSuccess 0.5s ease-out;
        }

        @keyframes scanSuccess {
            0% { background: rgba(255, 205, 0, 0.1); }
            25% { background: rgba(40, 167, 69, 0.4); }
            50% { background: rgba(40, 167, 69, 0.6); }
            75% { background: rgba(40, 167, 69, 0.4); }
            100% { background: rgba(40, 167, 69, 0.8); }
        }

        .scanner-success-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(40, 167, 69, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 100;
        }

        .success-checkmark {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #28a745;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin-bottom: 20px;
            animation: checkmarkBounce 0.6s ease-out;
            box-shadow: 0 0 30px rgba(40, 167, 69, 0.8);
        }

        @keyframes checkmarkBounce {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        .success-text {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            animation: fadeInUp 0.8s ease-out 0.3s both;
        }

        .success-vin {
            font-family: monospace;
            font-size: 18px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            letter-spacing: 2px;
            animation: fadeInUp 0.8s ease-out 0.5s both;
        }

        .success-progress {
            text-align: center;
            font-size: 16px;
            animation: fadeInUp 0.8s ease-out 0.7s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-transition {
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.6s ease-in-out;
        }

        .step-transition.entering {
            opacity: 1;
            transform: translateX(0);
        }

        .step-transition.leaving {
            opacity: 0;
            transform: translateX(-100%);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 205, 0, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            color: #000;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        /* VIN Decoder Styles */
        .vehicle-info-card {
            background: #f8f9fa;
            border: 2px solid #ffcd00;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .vehicle-info-card h3 {
            color: #000;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #ffcd00;
        }

        .info-label {
            font-size: 12px;
            color: #666;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 16px;
            color: #000;
            font-weight: bold;
        }

        .technical-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .technical-info h4 {
            color: #000;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .tech-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 12px;
            font-family: monospace;
        }

        .tech-details span {
            background: white;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .decoder-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #e3f2fd;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #2196f3;
        }

        .decoder-status .status-icon {
            font-size: 16px;
        }

        .decoder-status .status-text {
            font-size: 12px;
            color: #1976d2;
            font-weight: bold;
        }

        .technical-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .technical-info h4 {
            color: #000;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .tech-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 12px;
            font-family: monospace;
        }

        .tech-details span {
            background: white;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ADAC OEM Datenplattform</h1>
            <p>Zustimmung zur Fahrzeugdaten√ºbertragung</p>
        </div>

        <div class="content">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>

            <!-- Schritt 1: VIN Scanner -->
            <div class="step active" id="step1">
                <div class="step-header">Schritt 1: Fahrzeugidentifikation</div>
                
                <div class="scanner-container" id="scannerContainer" style="display: none;">
                    <video id="cameraVideo" autoplay playsinline></video>
                    <div class="scanner-overlay">
                        <div class="scanner-frame">
                            <div class="scanner-line"></div>
                            <div class="scanner-corners">
                                <div class="corner top-left"></div>
                                <div class="corner top-right"></div>
                                <div class="corner bottom-left"></div>
                                <div class="corner bottom-right"></div>
                            </div>
                        </div>
                        <div class="scanner-instructions">
                            <p>VIN auf dem Fahrzeugschein positionieren</p>
                            <div class="scanner-status" id="scannerStatus">Suche VIN...</div>
                        </div>
                        <button class="debug-toggle" onclick="toggleDebug()" id="debugToggle">üîç</button>
                        <div class="scanner-debug" id="scannerDebug" style="display: none;">
                            <h4>OCR Live-Debug</h4>
                            <div id="debugContent">Bereit f√ºr Scan...</div>
                        </div>
                        <button class="scanner-close-btn" onclick="stopScanner()">√ó</button>
                    </div>
                    
                    <!-- Success Overlay -->
                    <div class="scanner-success-overlay" id="successOverlay">
                        <div class="success-checkmark">‚úì</div>
                        <div class="success-text">VIN erfolgreich erkannt!</div>
                        <div class="success-vin" id="successVinDisplay"></div>
                        <div class="success-progress">Weiterleitung zur Systempr√ºfung...</div>
                    </div>
                </div>
                
                <div class="input-section" id="inputSection">
                    <div class="scan-option">
                        <button class="btn scan-btn" onclick="startScanner()">
                            üì∑ VIN scannen
                        </button>
                        <div class="or-divider">oder</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="vinInput">VIN manuell eingeben:</label>
                        <input type="text" 
                               id="vinInput" 
                               placeholder="z.B. WBABA91060ALxxxxx" 
                               maxlength="17"
                               style="text-transform: uppercase; letter-spacing: 1px; font-family: monospace;">
                        <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                            Bitte geben Sie die 17-stellige VIN aus Ihrem Fahrzeugschein ein
                        </small>
                    </div>

                    <button class="btn" onclick="processVIN()">VIN best√§tigen</button>
                </div>
            </div>

            <!-- Schritt 2: VIN Decoder -->
            <div class="step" id="step2">
                <div class="step-header">Schritt 2: Fahrzeugdaten ermittelt</div>
                
                <div class="vin-display">
                    <strong>Erkannte VIN:</strong> <span id="decodedVIN"></span>
                </div>

                <div class="vehicle-info-card">
                    <h3>üöó Fahrzeuginformationen</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Hersteller:</div>
                            <div class="info-value" id="vehicleMake">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Herkunftsland:</div>
                            <div class="info-value" id="vehicleCountry">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Region:</div>
                            <div class="info-value" id="vehicleRegion">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Modelljahr:</div>
                            <div class="info-value" id="vehicleYear">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Herstellerwerk:</div>
                            <div class="info-value" id="vehiclePlant">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Seriennummer:</div>
                            <div class="info-value" id="vehicleSerial">-</div>
                        </div>
                    </div>
                </div>

                <div class="technical-info">
                    <h4>üîß VIN-Struktur Details</h4>
                    <div class="tech-details">
                        <span><strong>WMI (1-3):</strong> <span id="vinWMI">-</span></span>
                        <span><strong>VDS (4-9):</strong> <span id="vinVDS">-</span></span>
                        <span><strong>VIS (10-17):</strong> <span id="vinVIS">-</span></span>
                        <span><strong>Jahr-Code:</strong> <span id="vinYearCode">-</span></span>
                        <span><strong>Werk-Code:</strong> <span id="vinPlantCode">-</span></span>
                        <span><strong>Serie:</strong> <span id="vehicleSerial">-</span></span>
                    </div>
                </div>

                <div class="decoder-status">
                    <span class="status-icon">üßÆ</span>
                    <span class="status-text">Pr√§zise manuelle VIN-Dekodierung</span>
                </div>

                <div class="technical-info">
                    <h4>üîß Technische VIN-Details</h4>
                    <div class="tech-details">
                        <span><strong>WMI:</strong> <span id="vinWMI">-</span></span>
                        <span><strong>VDS:</strong> <span id="vinVDS">-</span></span>
                        <span><strong>Werk:</strong> <span id="vinPlant">-</span></span>
                    </div>
                </div>

                <button class="btn" onclick="goToStep3()">Weiter zur Systempr√ºfung</button>
            </div>

            <!-- Schritt 3: Systempr√ºfung -->
            <div class="step" id="step3">
                <div class="step-header">Schritt 3: Systemkompatibilit√§t pr√ºfen</div>
                
                <div class="vin-display">
                    <strong>Fahrzeug-VIN:</strong> <span id="displayVIN"></span>
                </div>

                <ul class="verification-list">
                    <li class="verification-item" id="verification1">
                        <div class="verification-icon pending" id="icon1">?</div>
                        <div class="verification-text">Fahrzeug OEM-kompatibel</div>
                    </li>
                    <li class="verification-item" id="verification2">
                        <div class="verification-icon pending" id="icon2">?</div>
                        <div class="verification-text">SIM-Karte aktiv</div>
                    </li>
                    <li class="verification-item" id="verification3">
                        <div class="verification-icon pending" id="icon3">?</div>
                        <div class="verification-text">OEM Account verkn√ºpft</div>
                    </li>
                </ul>

                <button class="btn" id="continueBtn" onclick="goToStep4()" style="display: none;">Weiter</button>
            </div>

            <!-- Schritt 4: Login -->
            <div class="step" id="step4">
                <div class="step-header">Schritt 4: ADAC Mitglieds-Login</div>
                
                <div class="form-group">
                    <label for="memberNumber">Mitgliedsnummer:</label>
                    <input type="text" 
                           id="memberNumber" 
                           placeholder="z.B. 1234567"
                           maxlength="7">
                </div>

                <div class="form-group">
                    <label for="password">Passwort:</label>
                    <input type="password" 
                           id="password" 
                           placeholder="Ihr ADAC Passwort">
                </div>

                <button class="btn" onclick="processLogin()">Anmelden</button>
            </div>

            <!-- Schritt 5: Zustimmung -->
            <div class="step" id="step5">
                <div class="step-header">Schritt 5: Zustimmung zur Daten√ºbertragung</div>
                
                <div class="consent-text">
                    <strong>Zweck der Daten√ºbertragung:</strong><br>
                    Die √úbertragung Ihrer Fahrzeugdaten dient der Verbesserung unserer Pannenhilfe-Services. 
                    Durch die Analyse von Fahrzeugdaten k√∂nnen wir Ihnen schnellere und zielgerichtetere 
                    Hilfe im Pannenfall bieten.<br><br>
                    
                    <strong>√úbertragene Daten:</strong><br>
                    ‚Ä¢ Fahrzeugstatus und Diagnosedaten<br>
                    ‚Ä¢ GPS-Position im Pannenfall<br>
                    ‚Ä¢ Batteriestatus und Motorparameter<br>
                    ‚Ä¢ Fahrzeugidentifikation (VIN)
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="consentCheckbox">
                    <label for="consentCheckbox">
                        Ich best√§tige hiermit meine Zustimmung zur √úbertragung meiner Fahrzeugdaten 
                        an ADAC zum Zweck der Verbesserung der Pannenhilfe-Services. Mir ist bewusst, 
                        dass ich diese Zustimmung jederzeit widerrufen kann.
                    </label>
                </div>

                <button class="btn" id="finalSubmit" onclick="submitConsent()" disabled>
                    Zustimmung erteilen
                </button>
            </div>

            <!-- Erfolgsmeldung -->
            <div class="step" id="stepSuccess">
                <div class="success-message">
                    <div class="success-icon">‚úì</div>
                    <h2 style="color: #28a745; margin-bottom: 15px;">Zustimmung erfolgreich erteilt!</h2>
                    <p style="margin-bottom: 20px;">
                        Ihre Fahrzeugdaten werden ab sofort zur Verbesserung unserer Pannenhilfe-Services 
                        √ºbertragen. Sie k√∂nnen diese Zustimmung jederzeit in Ihrem ADAC Mitgliedsbereich widerrufen.
                    </p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 14px;">
                        <strong>Referenz-Nr:</strong> RUC-2025-<span id="referenceNumber"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Lade...</div>
        </div>

        <!-- Install Prompt -->
        <div class="install-prompt" id="installPrompt">
            <div id="installContent">
                <span>üì± App installieren f√ºr schnelleren Zugriff</span>
                <button onclick="installApp()">Installieren</button>
            </div>
            <button class="close-btn" onclick="hideInstallPrompt()">√ó</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let scannedVIN = '';
        let deferredPrompt;
        let cameraStream = null;

        const vinDatabase = {
            WBA: { manufacturer: 'BMW', country: 'Deutschland', region: 'Europa' },
            WDD: { manufacturer: 'Mercedes-Benz', country: 'Deutschland', region: 'Europa' },
            VF1: { manufacturer: 'Renault', country: 'Frankreich', region: 'Europa' },
            WAU: { manufacturer: 'Audi', country: 'Deutschland', region: 'Europa' },
            WVW: { manufacturer: 'Volkswagen', country: 'Deutschland', region: 'Europa' },
            JTD: { manufacturer: 'Toyota', country: 'Japan', region: 'Asien' },
            1FT: { manufacturer: 'Ford', country: 'USA', region: 'Nordamerika' },
            1G1: { manufacturer: 'Chevrolet', country: 'USA', region: 'Nordamerika' },
            WBS: { manufacturer: 'BMW M', country: 'Deutschland', region: 'Europa' }
        };

        const yearCodes = {
            A: 2010, B: 2011, C: 2012, D: 2013, E: 2014, F: 2015,
            G: 2016, H: 2017, J: 2018, K: 2019, L: 2020, M: 2021,
            N: 2022, P: 2023, R: 2024, S: 2025, T: 2026
        };
        // Pr√§zise VIN-Dekodierung basierend auf Wikipedia-Standard
        
        // WMI-Datenbank (World Manufacturer Identifier) - erste 3 Stellen
        const wmiDatabase = {
            // Deutsche Hersteller
            'WAG': { make: 'Neoplan', country: 'Deutschland' },
            'WAU': { make: 'Audi', country: 'Deutschland' },
            'WAP': { make: 'ALPINA', country: 'Deutschland' },
            'WBA': { make: 'BMW', country: 'Deutschland' },
            'WBS': { make: 'BMW M GmbH', country: 'Deutschland' },
            'WBY': { make: 'BMW i (Elektro)', country: 'Deutschland' },
            'WDB': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'W1K': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'W1N': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'WMX': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'WDC': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'WDD': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'WDF': { make: 'Mercedes-Benz AG', country: 'Deutschland' },
            'WEB': { make: 'EvoBus', country: 'Deutschland' },
            'WF0': { make: 'Ford Deutschland', country: 'Deutschland' },
            'WMA': { make: 'MAN', country: 'Deutschland' },
            'WME': { make: 'Smart', country: 'Deutschland' },
            'WMW': { make: 'MINI', country: 'Deutschland' },
            'WP0': { make: 'Porsche', country: 'Deutschland' },
            'WP1': { make: 'Porsche Cayenne/Macan', country: 'Deutschland' },
            'WUA': { make: 'Audi Sport GmbH', country: 'Deutschland' },
            'WVG': { make: 'Volkswagen', country: 'Deutschland' },
            'WVM': { make: 'VW-MAN', country: 'Deutschland' },
            'WVW': { make: 'Volkswagen', country: 'Deutschland' },
            'WV1': { make: 'Volkswagen Nutzfahrzeuge', country: 'Deutschland' },
            'WV2': { make: 'Volkswagen Nutzfahrzeuge', country: 'Deutschland' },
            'W0L': { make: 'Opel', country: 'Deutschland' },
            'W0V': { make: 'Vauxhall', country: 'Deutschland' },
            'VXK': { make: 'Opel', country: 'Deutschland' },

            // Andere europ√§ische Hersteller
            'VFA': { make: 'Alpine/Renault', country: 'Frankreich' },
            'VF1': { make: 'Renault', country: 'Frankreich' },
            'VF3': { make: 'Peugeot', country: 'Frankreich' },
            'VF7': { make: 'Citro√´n', country: 'Frankreich' },
            'VR1': { make: 'DS Automobiles', country: 'Frankreich' },
            'VR3': { make: 'Peugeot', country: 'Frankreich' },
            'VR7': { make: 'Citro√´n', country: 'Frankreich' },
            'VSS': { make: 'Seat', country: 'Spanien' },
            'YK1': { make: 'Saab', country: 'Schweden' },
            'YS3': { make: 'Saab', country: 'Schweden' },
            'YV1': { make: 'Volvo', country: 'Schweden' },
            'ZAR': { make: 'Alfa Romeo', country: 'Italien' },
            'ZCF': { make: 'Iveco', country: 'Italien' },
            'ZDF': { make: 'Ferrari Dino', country: 'Italien' },
            'ZFA': { make: 'Fiat', country: 'Italien' },
            'ZFF': { make: 'Ferrari', country: 'Italien' },
            'ZHW': { make: 'Lamborghini', country: 'Italien' },
            'ZLA': { make: 'Lancia', country: 'Italien' },
            'ZAM': { make: 'Maserati', country: 'Italien' },

            // Asiatische Hersteller
            'JA': { make: 'Isuzu', country: 'Japan' },
            'JF': { make: 'Subaru', country: 'Japan' },
            'JH': { make: 'Honda', country: 'Japan' },
            'JMB': { make: 'Mitsubishi', country: 'Japan' },
            'JMZ': { make: 'Mazda', country: 'Japan' },
            'JN': { make: 'Nissan', country: 'Japan' },
            'JS': { make: 'Suzuki', country: 'Japan' },
            'JT': { make: 'Toyota', country: 'Japan' },
            'KL': { make: 'Daewoo', country: 'S√ºdkorea' },
            'KMH': { make: 'Hyundai', country: 'S√ºdkorea' },
            'KN': { make: 'Kia', country: 'S√ºdkorea' },
            'KNE': { make: 'Kia (Montage nicht Korea)', country: 'S√ºdkorea' },

            // Amerikanische Hersteller
            '1C': { make: 'Chrysler', country: 'USA' },
            '1F': { make: 'Ford Motor Company', country: 'USA' },
            '1G': { make: 'General Motors', country: 'USA' },
            '1G3': { make: 'Oldsmobile', country: 'USA' },
            '1GC': { make: 'Chevrolet', country: 'USA' },
            '1GM': { make: 'Pontiac', country: 'USA' },
            '1H': { make: 'Honda USA', country: 'USA' },
            '1J': { make: 'Jeep', country: 'USA' },
            '1L': { make: 'Lincoln', country: 'USA' },
            '1M': { make: 'Mercury', country: 'USA' },
            '1N': { make: 'Nissan USA', country: 'USA' },
            '1VW': { make: 'Volkswagen USA', country: 'USA' },
            '1YV': { make: 'Mazda USA', country: 'USA' },
            '5YJ': { make: 'Tesla USA', country: 'USA' },
            '2F': { make: 'Ford Kanada', country: 'Kanada' },
            '2G': { make: 'General Motors Kanada', country: 'Kanada' },
            '3VW': { make: 'Volkswagen Mexiko', country: 'Mexiko' }
        };

        // Modelljahr-Codes (Stelle 10) - 30-Jahres-Zyklus
        const modelYearCodes = {
            // 1971-2000 / 2001-2030 / 2031-2060
            '1': [1971, 2001, 2031], '2': [1972, 2002, 2032], '3': [1973, 2003, 2033],
            '4': [1974, 2004, 2034], '5': [1975, 2005, 2035], '6': [1976, 2006, 2036],
            '7': [1977, 2007, 2037], '8': [1978, 2008, 2038], '9': [1979, 2009, 2039],
            'A': [1980, 2010, 2040], 'B': [1981, 2011, 2041], 'C': [1982, 2012, 2042],
            'D': [1983, 2013, 2043], 'E': [1984, 2014, 2044], 'F': [1985, 2015, 2045],
            'G': [1986, 2016, 2046], 'H': [1987, 2017, 2047], 'J': [1988, 2018, 2048],
            'K': [1989, 2019, 2049], 'L': [1990, 2020, 2050], 'M': [1991, 2021, 2051],
            'N': [1992, 2022, 2052], 'P': [1993, 2023, 2053], 'R': [1994, 2024, 2054],
            'S': [1995, 2025, 2055], 'T': [1996, 2026, 2056], 'V': [1997, 2027, 2057],
            'W': [1998, 2028, 2058], 'X': [1999, 2029, 2059], 'Y': [2000, 2030, 2060]
        };

        // Region basierend auf erster Stelle
        const regionCodes = {
            'A': 'Afrika', 'B': 'Afrika', 'C': 'Afrika', 'D': 'Afrika', 'E': 'Afrika', 'F': 'Afrika', 'G': 'Afrika', 'H': 'Afrika',
            'J': 'Asien', 'K': 'Asien', 'L': 'Asien', 'M': 'Asien', 'N': 'Asien', 'P': 'Asien', 'R': 'Asien',
            'S': 'Europa', 'T': 'Europa', 'U': 'Europa', 'V': 'Europa', 'W': 'Europa', 'X': 'Europa', 'Y': 'Europa', 'Z': 'Europa',
            '1': 'Nordamerika', '2': 'Nordamerika', '3': 'Nordamerika', '4': 'Nordamerika', '5': 'Nordamerika',
            '6': 'Australien/Ozeanien', '7': 'Australien/Ozeanien',
            '8': 'S√ºdamerika', '9': 'S√ºdamerika', '0': 'S√ºdamerika'
        };

        // Herstellerwerk-Codes (bekannte Beispiele f√ºr deutsche Hersteller)
        const plantCodes = {
            // Volkswagen
            'W': 'Wolfsburg', 'E': 'Emden', 'M': 'Puebla (Mexiko)', 'P': 'Mosel', 'T': 'Bratislava',
            // Opel  
            '1': 'R√ºsselsheim', '2': 'Bochum', '5': 'Antwerpen', '6': 'Azambuja',
            // Mercedes-Benz
            'F': 'Bremen', 'B': 'Bremen', 'J': 'Rastatt', 'R': 'Rastatt',
            // BMW
            'A': 'M√ºnchen', 'B': 'Leipzig', 'C': 'Regensburg', 'D': 'Dingolfing'
        };

        // Pr√§zise VIN-Dekodierung
        function decodeVIN(vin) {
            if (vin.length !== 17) return null;

            const wmi = vin.substring(0, 3);
            const vds = vin.substring(3, 9);
            const vis = vin.substring(9, 17);
            const yearCode = vin.charAt(9);
            const plantCode = vin.charAt(10);
            const serialNumber = vin.substring(11, 17);

            let manufacturerInfo = vinDatabase[wmi] || {
                manufacturer: 'Unbekannt',
                country: 'Unbekannt',
                region: 'Unbekannt'
            };

            if (manufacturerInfo.manufacturer === 'Unbekannt') {
                const wmiPrefix = wmi.substring(0, 2);
                for (const key in vinDatabase) {
                    if (key.startsWith(wmiPrefix)) {
                        manufacturerInfo = vinDatabase[key];
                        break;
                    }
                }
            }

            const modelYear = yearCodes[yearCode] || 'Unbekannt';

            return {
                wmi: wmi,
                vds: vds,
                vis: vis,
                yearCode: yearCode,
                plantCode: plantCode,
                serialNumber: serialNumber,
                manufacturer: manufacturerInfo.manufacturer,
                country: manufacturerInfo.country,
                region: manufacturerInfo.region,
                modelYear: modelYear,
                plant: `Werk ${plantCode}`
            };
        }

        // VIN-Validierung vereinfacht (nur Format, keine Check-Digit)
        function isValidVIN(vin) {
            // Nur pr√ºfen: 17 Zeichen, keine I/O/Q, alphanumerisch
            return /^[A-HJ-NPR-Z0-9]{17}$/.test(vin);
        }
        function displayVINData(vinData) {
            document.getElementById('manufacturer').textContent = vinData.manufacturer;
            document.getElementById('country').textContent = vinData.country;
            document.getElementById('region').textContent = vinData.region;
            document.getElementById('modelYear').textContent = vinData.modelYear;
            document.getElementById('plant').textContent = vinData.plant;
            document.getElementById('serialNumber').textContent = vinData.serialNumber;

            document.getElementById('wmi').textContent = vinData.wmi;
            document.getElementById('vds').textContent = vinData.vds;
            document.getElementById('vis').textContent = vinData.vis;
            document.getElementById('yearCode').textContent = vinData.yearCode;
            document.getElementById('plantCode').textContent = vinData.plantCode;
            document.getElementById('series').textContent = vinData.serialNumber;
        }

        // Check-Digit Validierung entfernt f√ºr einfachere Tests
        function validateVINCheckDigit(vin) {
            // Immer true zur√ºckgeben - nur f√ºr Prototype
            return true;
        }

        // Aufw√§ndige VIN-Erfolgs-Darstellung
        function showVINSuccess(detectedVIN) {
            const successOverlay = document.getElementById('successOverlay');
            const successVinDisplay = document.getElementById('successVinDisplay');
            const scannerFrame = document.querySelector('.scanner-frame');
            
            // VIN in Success-Display setzen
            successVinDisplay.textContent = detectedVIN;
            
            // Scanner-Frame Erfolgsanimation
            scannerFrame.classList.add('scanner-success');
            
            // Success-Overlay nach kurzer Verz√∂gerung zeigen
            setTimeout(() => {
                successOverlay.style.display = 'flex';
                
                // Vibrieren falls verf√ºgbar
                if ('vibrate' in navigator) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                // Automatische Weiterleitung nach 3 Sekunden
                setTimeout(() => {
                    document.getElementById('vinInput').value = detectedVIN;
                    scannedVIN = detectedVIN;
                    
                    // Smooth transition zur n√§chsten Seite
                    smoothTransitionToNextStep();
                }, 3000);
                
            }, 800);
        }

        // Smooth transition zwischen Schritten
        function smoothTransitionToNextStep() {
            showLoadingOverlay('Dekodiere VIN-Daten...', () => {
                stopScanner();
                showVINDecoder(scannedVIN);
            });
        }

        // Loading-Overlay anzeigen
        function showLoadingOverlay(text, callback) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            
            loadingText.textContent = text;
            loadingOverlay.style.display = 'flex';
            
            // Nach 1.5 Sekunden callback ausf√ºhren und overlay verstecken
            setTimeout(() => {
                if (callback) {
                    callback();
                }
                loadingOverlay.style.display = 'none';
            }, 1500);
        }

        // Smooth Schritt-Wechsel mit Animationen
        function smoothShowStep(stepNumber) {
            const currentStep = document.querySelector('.step.active');
            const nextStep = document.getElementById('step' + stepNumber);
            
            // Current step ausblenden
            if (currentStep) {
                currentStep.classList.add('step-transition', 'leaving');
                
                setTimeout(() => {
                    currentStep.classList.remove('active', 'step-transition', 'leaving');
                }, 300);
            }
            
            // Next step einblenden
            setTimeout(() => {
                nextStep.classList.add('active', 'step-transition');
                updateProgress(stepNumber);
                
                setTimeout(() => {
                    nextStep.classList.add('entering');
                    
                    setTimeout(() => {
                        nextStep.classList.remove('step-transition', 'entering');
                    }, 600);
                }, 50);
            }, 300);
        }
        function toggleDebug() {
            const debugPanel = document.getElementById('scannerDebug');
            const toggleBtn = document.getElementById('debugToggle');
            
            if (debugPanel.style.display === 'none') {
                debugPanel.style.display = 'block';
                toggleBtn.textContent = '‚ùå';
            } else {
                debugPanel.style.display = 'none';
                toggleBtn.textContent = 'üîç';
            }
        }

        // Debug-Anzeige aktualisieren (komplett √ºberarbeitet)
        function updateDebugInfo(message, type = 'info') {
            const debugContent = document.getElementById('debugContent');
            if (!debugContent) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const debugLine = document.createElement('div');
            debugLine.className = `debug-line ${type}`;
            
            // Symbole f√ºr bessere Erkennbarkeit
            let icon = '';
            switch(type) {
                case 'success': icon = '‚úÖ'; break;
                case 'error': icon = '‚ùå'; break;
                case 'warning': icon = '‚ö†Ô∏è'; break;
                case 'ocr': icon = 'üìù'; break;
                default: icon = '‚ÑπÔ∏è';
            }
            
            debugLine.innerHTML = `<strong>${icon} ${timestamp}:</strong> ${message}`;
            debugContent.appendChild(debugLine);
            
            // Scroll zum Ende
            debugContent.scrollTop = debugContent.scrollHeight;
            
            // Nur die letzten 8 Zeilen behalten (weniger f√ºr bessere √úbersicht)
            const lines = debugContent.querySelectorAll('.debug-line');
            if (lines.length > 8) {
                lines[0].remove();
            }
        }

        // OCR-Processing f√ºr Kamera-Frames (vereinfacht f√ºr einfache Tests)
        async function processVideoFrame() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Kleinere Canvas-Gr√∂√üe f√ºr bessere Performance
            const scale = 0.5;
            canvas.width = video.videoWidth * scale;
            canvas.height = video.videoHeight * scale;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            try {
                updateDebugInfo('Analysiere Bild...', 'info');
                
                const result = await Tesseract.recognize(canvas, 'eng', {
                    whitelist: 'ABCDEFGHJKLMNPRSTUVWXYZ0123456789',
                    psm: 6 // Document mode
                });
                
                const rawText = result.data.text;
                const cleanText = rawText.replace(/[\s\n\r]/g, '').toUpperCase();
                
                // K√ºrze die Ausgabe f√ºr bessere Lesbarkeit
                const shortRaw = rawText.substring(0, 30) + (rawText.length > 30 ? '...' : '');
                
                updateDebugInfo(`Roher Text: "${shortRaw}"`, 'ocr');
                
                // Suche nach 17-stelligen VIN-Kandidaten
                const vinCandidates = cleanText.match(/[A-HJ-NPR-Z0-9]{17}/g) || [];
                
                if (vinCandidates.length > 0) {
                    updateDebugInfo(`${vinCandidates.length} VIN-Kandidat(en) gefunden`, 'warning');
                    
                    for (const candidate of vinCandidates) {
                        updateDebugInfo(`Teste: ${candidate}`, 'info');
                        if (isValidVIN(candidate)) {
                            updateDebugInfo(`‚úÖ G√úLTIGE VIN: ${candidate}`, 'success');
                            return candidate;
                        }
                    }
                } else {
                    // Zeige verf√ºgbare Segmente f√ºr bessere Diagnose
                    const segments = cleanText.match(/[A-HJ-NPR-Z0-9]{10,16}/g) || [];
                    if (segments.length > 0) {
                        updateDebugInfo(`Kurze Segmente: ${segments.slice(0,2).join(', ')}...`, 'warning');
                    } else {
                        updateDebugInfo('Keine VIN-√§hnlichen Sequenzen', 'error');
                    }
                }
                
            } catch (error) {
                console.error('OCR Error:', error);
                updateDebugInfo(`OCR Fehler: ${error.message}`, 'error');
            }
            
            return null;
        }

        // VIN Scanner Funktionen
        async function startScanner() {
            try {
                const scannerContainer = document.getElementById('scannerContainer');
                const inputSection = document.getElementById('inputSection');
                const cameraVideo = document.getElementById('cameraVideo');
                const scannerStatus = document.getElementById('scannerStatus');
                const debugContent = document.getElementById('debugContent');
                
                // UI umschalten
                inputSection.style.display = 'none';
                scannerContainer.style.display = 'block';
                
                // Debug-Info zur√ºcksetzen
                debugContent.innerHTML = 'Bereit f√ºr Scan...';
                
                // Kamera-Zugriff anfordern
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: 'environment', // R√ºckkamera bevorzugen
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                cameraVideo.srcObject = cameraStream;
                scannerStatus.textContent = 'Kamera wird gestartet...';
                updateDebugInfo('üì∑ Kamera aktiviert', 'info');
                
                // Warte bis Video bereit ist
                await new Promise(resolve => {
                    cameraVideo.addEventListener('loadedmetadata', resolve, { once: true });
                });
                
                scannerStatus.textContent = 'Suche VIN...';
                updateDebugInfo('‚úÖ Kamera bereit - Starte Scan-Prozess', 'info');
                
                // OCR-Loop alle 2 Sekunden (h√§ufiger f√ºr bessere Erkennung)
                const scanInterval = setInterval(async () => {
                    if (!cameraStream) {
                        clearInterval(scanInterval);
                        return;
                    }
                    
                    scannerStatus.textContent = 'Analysiere Bild...';
                    const detectedVIN = await processVideoFrame();
                    
                    if (detectedVIN) {
                        clearInterval(scanInterval);
                        scannerStatus.textContent = 'üéâ VIN erkannt!';
                        updateDebugInfo(`üéØ SCANNER ERFOLGREICH: ${detectedVIN}`, 'candidates');
                        document.querySelector('.scanner-frame').classList.add('scanner-success');
                        
                        setTimeout(() => {
                            document.getElementById('vinInput').value = detectedVIN;
                            scannedVIN = detectedVIN;
                            stopScanner();
                            
                            setTimeout(() => {
                                processVIN();
                            }, 500);
                        }, 1500);
                    } else {
                        scannerStatus.textContent = 'Suche VIN...';
                    }
                }, 2000); // H√§ufiger scannen
                
                // Store interval f√ºr cleanup
                window.currentScanInterval = scanInterval;
                
            } catch (error) {
                console.error('Kamera-Zugriff fehlgeschlagen:', error);
                updateDebugInfo(`üí• Kamera-Fehler: ${error.message}`, 'error');
                alert('Kamera-Zugriff nicht m√∂glich. Bitte VIN manuell eingeben.');
                stopScanner();
            }
        }

        function stopScanner() {
            // Clear OCR interval
            if (window.currentScanInterval) {
                clearInterval(window.currentScanInterval);
                window.currentScanInterval = null;
            }
            
            const scannerContainer = document.getElementById('scannerContainer');
            const inputSection = document.getElementById('inputSection');
            const successOverlay = document.getElementById('successOverlay');
            
            // Kamera-Stream stoppen
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            
            // UI zur√ºcksetzen
            scannerContainer.style.display = 'none';
            inputSection.style.display = 'block';
            successOverlay.style.display = 'none';
            
            // Scanner-Status zur√ºcksetzen
            document.getElementById('scannerStatus').textContent = 'Suche VIN...';
            document.querySelector('.scanner-frame').classList.remove('scanner-success');
        }

        // Browser Detection
        function isSafari() {
            return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        }

        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }

        function isStandalone() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });

        function showInstallPrompt() {
            if (isStandalone()) return; // Bereits installiert
            
            const installPrompt = document.getElementById('installPrompt');
            const installContent = document.getElementById('installContent');
            
            if (isSafari() || isIOS()) {
                // Safari/iOS spezifische Anweisungen
                installContent.innerHTML = `
                    <div>
                        <div>üì± <strong>App installieren:</strong></div>
                        <div class="safari-instructions">
                            Tippen Sie auf <strong>Teilen</strong> <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.05 4.11c-.05.23-.09.46-.09.7 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/></svg> unten, dann auf <strong>"Zum Home-Bildschirm"</strong>
                        </div>
                    </div>
                `;
            } else {
                // Chrome/Android Standard
                installContent.innerHTML = `
                    <span>üì± App installieren f√ºr schnelleren Zugriff</span>
                    <button onclick="installApp()">Installieren</button>
                `;
            }
            
            installPrompt.style.display = 'flex';
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').style.display = 'none';
            localStorage.setItem('installPromptDismissed', 'true');
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App wurde installiert');
                    }
                    deferredPrompt = null;
                    hideInstallPrompt();
                });
            } else if (isSafari() || isIOS()) {
                // F√ºr Safari - Anweisungen sind bereits angezeigt
                console.log('Safari: Nutzer muss manuell installieren');
            }
        }

        // Fallback: Install-Prompt nach 3 Sekunden anzeigen wenn noch nicht installiert
        setTimeout(() => {
            if (!isStandalone() && 
                !localStorage.getItem('installPromptDismissed')) {
                showInstallPrompt();
            }
        }, 3000);

        // Nach Installation ausblenden
        window.addEventListener('appinstalled', () => {
            hideInstallPrompt();
            console.log('PWA wurde installiert');
        });

        // Progress aktualisieren (f√ºr 5 Schritte)
        function updateProgress(step) {
            const progressFill = document.getElementById('progressFill');
            const percentage = (step / 5) * 100;
            progressFill.style.width = percentage + '%';
        }

        // Test der VIN-Dekodierung beim Laden der Seite
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM geladen - teste VIN-Dekodierung');
            const testVIN = 'WVWZZZ7NZHV201424';
            const testResult = decodeVIN(testVIN);
            console.log('Test VIN-Dekodierung:', testVIN, '->', testResult);
        });

        // Debug Test-Funktion
        function testVINDecoder() {
            console.log('üß™ TEST: VIN-Decoder wird manuell getestet');
            const testVIN = 'WVWZZZ7NZHV201424';
            scannedVIN = testVIN;
            
            // Direkt showVINDecoder aufrufen
            showVINDecoder(testVIN);
        }
        function showVINDecoder(vin) {
            console.log('showVINDecoder aufgerufen mit VIN:', vin);
            
            // Erst zur VIN-Decoder Seite wechseln
            smoothShowStep(2);
            
            // VIN dekodieren
            const decoded = decodeVIN(vin);
            console.log('VIN dekodiert:', decoded);
            
            // Felder mit dekodierten Daten f√ºllen
            setTimeout(() => {
                console.log('F√ºlle Felder aus...');
                
                const decodedVINEl = document.getElementById('decodedVIN');
                const vehicleMakeEl = document.getElementById('vehicleMake');
                const vehicleCountryEl = document.getElementById('vehicleCountry');
                const vehicleRegionEl = document.getElementById('vehicleRegion');
                const vehicleYearEl = document.getElementById('vehicleYear');
                const vehiclePlantEl = document.getElementById('vehiclePlant');
                const vehicleSerialEl = document.getElementById('vehicleSerial');
                const vinWMIEl = document.getElementById('vinWMI');
                const vinVDSEl = document.getElementById('vinVDS');
                const vinVISEl = document.getElementById('vinVIS');
                const vinYearCodeEl = document.getElementById('vinYearCode');
                const vinPlantCodeEl = document.getElementById('vinPlantCode');
                
                // Debug: Pr√ºfe ob Elemente existieren
                console.log('Elemente gefunden:', {
                    decodedVIN: !!decodedVINEl,
                    vehicleMake: !!vehicleMakeEl,
                    vehicleCountry: !!vehicleCountryEl,
                    vehicleRegion: !!vehicleRegionEl,
                    vehicleYear: !!vehicleYearEl,
                    vehiclePlant: !!vehiclePlantEl,
                    vehicleSerial: !!vehicleSerialEl
                });
                
                // Setze Werte
                if (decodedVINEl) decodedVINEl.textContent = vin;
                if (vehicleMakeEl) vehicleMakeEl.textContent = decoded.manufacturer;
                if (vehicleCountryEl) vehicleCountryEl.textContent = decoded.country;
                if (vehicleRegionEl) vehicleRegionEl.textContent = decoded.region;
                if (vehicleYearEl) vehicleYearEl.textContent = decoded.modelYear;
                if (vehiclePlantEl) vehiclePlantEl.textContent = decoded.plant;
                if (vehicleSerialEl) vehicleSerialEl.textContent = decoded.serialNumber;
                
                // Technische VIN-Details
                if (vinWMIEl) vinWMIEl.textContent = decoded.wmi;
                if (vinVDSEl) vinVDSEl.textContent = decoded.vds;
                if (vinVISEl) vinVISEl.textContent = decoded.vis;
                if (vinYearCodeEl) vinYearCodeEl.textContent = decoded.modelYearCode;
                if (vinPlantCodeEl) vinPlantCodeEl.textContent = decoded.plantCode;
                
                console.log('Felder ausgef√ºllt');
            }, 100);
        }

        // Schritt wechseln (legacy - f√ºr Cleanup etc.)
        function showStep(stepNumber) {
            // Kamera stoppen wenn aktiv
            if (cameraStream) {
                stopScanner();
            }
            
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step' + stepNumber).classList.add('active');
            currentStep = stepNumber;
            updateProgress(stepNumber);
        }

        // Debug-Toggle Funktion
        function toggleDebug() {
            const debugPanel = document.getElementById('scannerDebug');
            const toggleBtn = document.getElementById('debugToggle');
            
            if (debugPanel.style.display === 'none') {
                debugPanel.style.display = 'block';
                toggleBtn.textContent = '‚ùå';
            } else {
                debugPanel.style.display = 'none';
                toggleBtn.textContent = 'üîç';
            }
        }
        function showStep(stepNumber) {
            // Kamera stoppen wenn aktiv
            if (cameraStream) {
                stopScanner();
            }
            
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step' + stepNumber).classList.add('active');
            currentStep = stepNumber;
            updateProgress(stepNumber);
        }

        // Debug-Toggle Funktion

        // Cleanup beim Verlassen der Seite
        window.addEventListener('beforeunload', () => {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            if (window.currentScanInterval) {
                clearInterval(window.currentScanInterval);
            }
        });

        // Cleanup bei Visibility Change (App in Hintergrund)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && cameraStream) {
                stopScanner();
            }
        });

        // VIN verarbeiten (f√ºr manuelle Eingabe)
        function processVIN() {
            const vinInput = document.getElementById('vinInput');
            const vin = vinInput.value.trim().toUpperCase();

            if (vin.length !== 17) {
                alert('Bitte geben Sie eine g√ºltige 17-stellige VIN ein.');
                return;
            }

            scannedVIN = vin;
            document.getElementById('displayVIN').textContent = vin;

            const vinData = decodeVIN(vin);
            if (vinData) {
                displayVINData(vinData);
            }

            showStep(2);

            setTimeout(() => {
                startVerification();
            }, 500);
        }

        // Systempr√ºfung starten
        function startVerification() {
            const verifications = [
                { id: 'verification1', icon: 'icon1', delay: 1000 },
                { id: 'verification2', icon: 'icon2', delay: 2500 },
                { id: 'verification3', icon: 'icon3', delay: 4000 }
            ];

            verifications.forEach((verification, index) => {
                setTimeout(() => {
                    // Checking-Status
                    const verificationEl = document.getElementById(verification.id);
                    const iconEl = document.getElementById(verification.icon);
                    
                    verificationEl.classList.add('checking');
                    iconEl.classList.remove('pending');
                    iconEl.classList.add('checking');
                    iconEl.textContent = '...';

                    // Nach 1 Sekunde auf Success
                    setTimeout(() => {
                        verificationEl.classList.remove('checking');
                        verificationEl.classList.add('success');
                        iconEl.classList.remove('checking');
                        iconEl.classList.add('success');
                        iconEl.textContent = '‚úì';

                        // Wenn alle durch sind, Weiter-Button zeigen
                        if (index === verifications.length - 1) {
                            setTimeout(() => {
                                document.getElementById('continueBtn').style.display = 'block';
                            }, 500);
                        }
                    }, 1000);
                }, verification.delay);
            });
        }

        // Zu Schritt 3 mit smooth transition
        function goToStep3() {
            showLoadingOverlay('Bereite ADAC Login vor...', () => {
                smoothShowStep(3);
            });
        }

        // Login verarbeiten mit smooth transition
        function processLogin() {
            const memberNumber = document.getElementById('memberNumber').value;
            const password = document.getElementById('password').value;

            if (memberNumber !== '1234567') {
                alert('Ung√ºltige Mitgliedsnummer. Bitte verwenden Sie: 1234567');
                return;
            }

            if (password !== 'pass1234') {
                alert('Ung√ºltiges Passwort. Bitte verwenden Sie: pass1234');
                return;
            }

            showLoadingOverlay('Authentifiziere Mitgliedsdaten...', () => {
                smoothShowStep(5);
            });
        }

        // Finale Zustimmung mit smooth transition
        function submitConsent() {
            // Referenznummer generieren
            const referenceNumber = Date.now().toString().slice(-8);
            document.getElementById('referenceNumber').textContent = referenceNumber;
            
            showLoadingOverlay('Verarbeite Zustimmung...', () => {
                smoothShowStep('Success');
            });
        }

        // Systempr√ºfung starten
        function startVerification() {
            const verifications = [
                { id: 'verification1', icon: 'icon1', delay: 1000 },
                { id: 'verification2', icon: 'icon2', delay: 2500 },
                { id: 'verification3', icon: 'icon3', delay: 4000 }
            ];

            verifications.forEach((verification, index) => {
                setTimeout(() => {
                    // Checking-Status
                    const verificationEl = document.getElementById(verification.id);
                    const iconEl = document.getElementById(verification.icon);
                    
                    verificationEl.classList.add('checking');
                    iconEl.classList.remove('pending');
                    iconEl.classList.add('checking');
                    iconEl.textContent = '...';

                    // Nach 1 Sekunde auf Success
                    setTimeout(() => {
                        verificationEl.classList.remove('checking');
                        verificationEl.classList.add('success');
                        iconEl.classList.remove('checking');
                        iconEl.classList.add('success');
                        iconEl.textContent = '‚úì';

                        // Wenn alle durch sind, Weiter-Button zeigen
                        if (index === verifications.length - 1) {
                            setTimeout(() => {
                                document.getElementById('continueBtn').style.display = 'block';
                            }, 500);
                        }
                    }, 1000);
                }, verification.delay);
            });
        }

        // Zu Schritt 3
        function goToStep3() {
            showStep(3);
        }

        // Login verarbeiten
        function processLogin() {
            const memberNumber = document.getElementById('memberNumber').value;
            const password = document.getElementById('password').value;

            if (memberNumber !== '1234567') {
                alert('Ung√ºltige Mitgliedsnummer. Bitte verwenden Sie: 1234567');
                return;
            }

            if (password !== 'pass1234') {
                alert('Ung√ºltiges Passwort. Bitte verwenden Sie: pass1234');
                return;
            }

            showStep(4);
        }

        // Zustimmung-Checkbox √ºberwachen
        document.getElementById('consentCheckbox').addEventListener('change', function() {
            const submitBtn = document.getElementById('finalSubmit');
            submitBtn.disabled = !this.checked;
        });

        // Finale Zustimmung
        function submitConsent() {
            // Referenznummer generieren
            const referenceNumber = Date.now().toString().slice(-8);
            document.getElementById('referenceNumber').textContent = referenceNumber;
            
            showStep('Success');
        }

        // Eingabe-Validierung f√ºr VIN
        document.getElementById('vinInput').addEventListener('input', function() {
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        });

        // Eingabe-Validierung f√ºr Mitgliedsnummer
        document.getElementById('memberNumber').addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // PWA Service Worker registrieren (entfernt wegen data: URL Problemen)
        // if ('serviceWorker' in navigator) {
        //     navigator.serviceWorker.register('...')
        // }
    </script>
</body>
</html>
